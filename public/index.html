<html>

<head>
    <link rel="manifest" href="/manifest.json">
</head>

<body>
    hello enter product url here: <input type="text" class="input-url"></input>
    <br />
    <button class="button-submit">submit</button>

    <script src="/zepto.min.js"></script>
    <script src="/firebase.js"></script>
    <script>
        var SERVER_URL = "https://sparfuchs-agent.herokuapp.com";

        var messaging;

        function initializeFirebase() {
            var config = {
                apiKey: "AIzaSyBWMWMExk-jpZHDUaci6262sej5lEimlug",
                authDomain: "sparfuchs-agent.firebaseapp.com",
                databaseURL: "https://sparfuchs-agent.firebaseio.com",
                storageBucket: "sparfuchs-agent.appspot.com",
                messagingSenderId: "643626212515"
            };
            firebase.initializeApp(config);

            messaging = firebase.messaging();
            messaging.onTokenRefresh(saveDeviceToken);

            var promise = messaging.requestPermission();
            promise = promise.then(saveDeviceToken);
            promise.catch(console.error);

            messaging.onMessage(console.log);
        }

        function saveDeviceToken() {
            var promise = messaging.getToken();
            promise = promise.then(function(deviceToken) {
                var requestOptions = {};
                requestOptions.method = "POST";
                requestOptions.url = SERVER_URL + "/user/device?userKey=1234&deviceToken=" + deviceToken;

                var promise = $.ajax(requestOptions);
                return promise;
            });

            return promise;
        }

        function initializeUi() {
            $(".button-submit").click(function() {
                var productUrl = $(".input-url").val();

                var requestOptions = {};
                requestOptions.method = "POST";
                requestOptions.url = SERVER_URL + "/product?userKey=1234&productUrl=" + productUrl;

                var promise = $.ajax(requestOptions);
                promise.done(console.log);
                promise.fail(console.error);
            });
        }

        initializeFirebase();

        initializeUi();
    </script>
</body>

</html>
